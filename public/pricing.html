<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pricing — MeetingMind</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="navbar">
    <a href="/" class="logo">MeetingMind</a>
    <nav id="nav-links">
      <a href="/login.html">Log in</a>
      <a href="/signup.html" class="btn btn-primary btn-small">Sign up free</a>
    </nav>
  </div>

  <div class="container">
    <div class="pricing-header">
      <h1>Simple, transparent pricing</h1>
      <p>Pay once forever, or subscribe monthly. Cancel anytime.</p>
    </div>

    <!-- Lifetime badge for existing LTD/FLTD users -->
    <div class="lifetime-banner" id="lifetime-banner" style="display:none">
      You're a <strong>Lifetime Member</strong>. No subscriptions needed — you have permanent access.
    </div>

    <!-- Section: Lifetime -->
    <h2 class="pricing-section-title">Lifetime Deal — Pay Once</h2>
    <div class="pricing-grid" id="lifetime-grid">
      <div class="pricing-card">
        <h3>Free</h3>
        <div class="price">$0</div>
        <ul class="plan-features">
          <li>5 extractions (lifetime)</li>
          <li>AI action items</li>
          <li>Follow-up email drafts</li>
          <li>Voice recording</li>
        </ul>
        <a href="/signup.html" class="btn btn-secondary" style="width:100%">Get Started</a>
      </div>

      <div class="pricing-card featured">
        <span class="badge">Most Popular</span>
        <h3>LTD</h3>
        <div class="price">$49 <span class="price-note">one-time</span></div>
        <ul class="plan-features">
          <li>50 extractions / month</li>
          <li>AI action items</li>
          <li>Follow-up email drafts</li>
          <li>Voice recording</li>
          <li>Lifetime access</li>
        </ul>
        <button class="btn btn-primary lifetime-buy-btn" style="width:100%" onclick="checkout('ltd', 'one_time')">Get LTD</button>
      </div>

      <!-- FLTD card hidden for beta — backend entitlements preserved -->
      <!--
      <div class="pricing-card">
        <h3>FLTD</h3>
        <div class="price">$69 <span class="price-note">one-time</span></div>
        <ul class="plan-features">
          <li>100 extractions / month</li>
          <li>AI action items</li>
          <li>Follow-up email drafts</li>
          <li>Voice recording</li>
          <li>Lifetime access</li>
          <li>Priority support</li>
        </ul>
        <button class="btn btn-primary lifetime-buy-btn" style="width:100%" onclick="checkout('fltd', 'one_time')">Get FLTD</button>
      </div>
      -->
    </div>

    <!-- Section: Subscriptions -->
    <div id="subscription-section">
      <h2 class="pricing-section-title">Monthly Subscription</h2>
      <div class="pricing-grid">
        <div class="pricing-card">
          <h3>Basic</h3>
          <div class="price">$9 <span class="price-note">/ month</span></div>
          <ul class="plan-features">
            <li>50 extractions / month</li>
            <li>AI action items</li>
            <li>Follow-up email drafts</li>
            <li>Voice recording</li>
          </ul>
          <button class="btn btn-primary sub-buy-btn" style="width:100%" onclick="checkout('sub_basic', 'subscription')">Subscribe</button>
        </div>

        <div class="pricing-card">
          <h3>Pro</h3>
          <div class="price">$19 <span class="price-note">/ month</span></div>
          <ul class="plan-features">
            <li>100 extractions / month</li>
            <li>AI action items</li>
            <li>Follow-up email drafts</li>
            <li>Voice recording</li>
            <li>Priority support</li>
          </ul>
          <button class="btn btn-primary sub-buy-btn" style="width:100%" onclick="checkout('sub_pro', 'subscription')">Subscribe</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;

    // Check auth and adapt UI
    fetch('/api/auth/me')
      .then(r => r.ok ? r.json() : null)
      .then(user => {
        if (user) {
          currentUser = user;
          document.getElementById('nav-links').innerHTML =
            '<a href="/dashboard.html">Dashboard</a> <a href="/account.html">Account</a>';

          if (user.is_lifetime) {
            // Show lifetime banner, hide subscription section, disable LTD buttons
            document.getElementById('lifetime-banner').style.display = 'block';
            document.getElementById('subscription-section').style.display = 'none';
            document.querySelectorAll('.lifetime-buy-btn').forEach(btn => {
              btn.disabled = true;
              btn.textContent = 'You own this';
              btn.classList.remove('btn-primary');
              btn.classList.add('btn-secondary');
            });
          }
        }
      });

    async function checkout(plan, type) {
      if (!currentUser) {
        window.location.href = '/signup.html';
        return;
      }

      const endpoint = type === 'subscription'
        ? '/api/billing/create-subscription-session'
        : '/api/billing/create-checkout-session';

      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ plan })
      });

      const data = await res.json();

      if (!res.ok) {
        alert(data.error);
        return;
      }

      window.location.href = data.url;
    }
  </script>
  <script src="/js/theme.js"></script>
</body>
</html>
